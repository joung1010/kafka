## 카프카 클러스터
Kafka 클러스터는 데이터의 중심 저장소이자 전송의 허브 역할을 하며, 여러 브로커(노드)로 구성된 분산 시스템입니다.

### 카프카 클러스터를 운영하는 방법
아파치 카프카 클러스터를 서버에 직접 설치하고 운영하는 것은 전통적이고 기본적인 방법이다. 이 방법은 각정 설정을 컨트롤하여 세부적인 서버 설정을 통해 최고의 성능으로 최적의 클러스터를 활용할 수 있다.  
  
그러나 그만큼 많은 노하우가 필요하고 많은 시행착오를 거쳐야한다. 특히 각정 보안 설정이나 모니터링 도구를 선택하고 설치, 운영할 때는 수 맣은 선택지 때문에 어려움을 겪을 수 있다.  
  
이러한 시행착오를 줄이면서 빠르고 안전하게 설치하여 운영하기 위해 `Sass`를 도입할 수 있다.  


---

### 운영 방법에 따른 서비스 형태

### 1. 온프레미스 (On-Premises)

**정의**

- **온프레미스 환경**은 기업이 자체 데이터 센터나 서버실에 물리적인 인프라(서버, 스토리지, 네트워크 장비 등)를 직접 구축하여 운영하는 방식입니다.

**특징**

- **물리적 자산 관리:** 모든 하드웨어, 소프트웨어, 네트워크 등의 자산을 기업 내부에서 소유하고 관리합니다.
- **보안 및 제어:** 데이터 및 애플리케이션에 대한 완전한 제어권을 보유하며, 보안 정책을 기업 맞춤형으로 설정할 수 있습니다.
- **대규모 초기 투자:** 하드웨어와 소프트웨어 구매, 구축 및 유지보수 비용 등 초기 투자 비용이 상당히 큽니다.

**장점**

- 높은 수준의 커스터마이징 및 제어권 확보
- 기업 내부 보안 정책에 따른 맞춤형 보안 솔루션 적용 가능

**단점**

- 초기 구축 및 유지 관리 비용 증가
- 확장성 및 유연성 제한
- 최신 기술 도입 및 업데이트가 느릴 수 있음

---

### 2. IaaS (Infrastructure as a Service)

**정의**

- **IaaS**는 가상화된 컴퓨팅 리소스(서버, 스토리지, 네트워크 등)를 인터넷을 통해 제공하는 서비스입니다. 사용자는 물리적 인프라 대신 클라우드 제공업체가 관리하는 리소스를 사용하여, OS, 미들웨어, 런타임, 애플리케이션 등을 직접 설치하고 관리합니다.

**특징**

- **유연한 리소스 확장:** 필요한 만큼 리소스를 동적으로 할당하고 해제할 수 있습니다.
- **비용 절감:** 사용한 만큼 비용을 지불하는 모델(Pay-as-you-go)로 초기 투자 비용을 줄일 수 있습니다.
- **관리 범위:** 하드웨어와 기본 네트워크, 스토리지 등의 인프라는 제공업체가 관리하며, 고객은 상위 계층(운영체제 및 애플리케이션)에 집중할 수 있습니다.

**장점**

- 높은 확장성과 유연성
- 신속한 인프라 구축 및 배포
- 초기 자본 비용 감소 및 운영 비용 최적화

**단점**

- 운영체제와 미들웨어, 애플리케이션 관리는 여전히 사용자의 책임
- 클라우드 제공업체의 가용성 및 보안 이슈에 종속적일 수 있음

**예시**

- Amazon Web Services (AWS) EC2, Microsoft Azure Virtual Machines, Google Compute Engine

---

### 3. PaaS (Platform as a Service)

**정의**

- **PaaS**는 애플리케이션 개발 및 배포를 위한 플랫폼을 제공하는 서비스입니다. 클라우드 공급업체가 인프라, 미들웨어, 운영체제 및 런타임 등을 관리해 주고, 개발자는 애플리케이션 코드 작성과 배포에 집중할 수 있습니다.

**특징**

- **개발 환경 제공:** 데이터베이스, 캐시, 메시징 시스템 등 다양한 개발 도구와 서비스를 통합 제공하여 애플리케이션 개발을 지원합니다.
- **자동 확장:** 트래픽 증가 시 자동으로 리소스가 확장되는 기능을 제공하는 경우가 많습니다.
- **관리 부담 경감:** 인프라, 보안 패치, 백업 등 대부분의 운영 관리를 플랫폼 공급업체가 담당합니다.

**장점**

- 애플리케이션 개발 및 배포 시간 단축
- IT 인프라 관리 부담 감소
- 유지보수 및 보안 패치 등 운영 부담 경감

**단점**

- 플랫폼에 종속될 위험(Vendor Lock-in)
- 제공되는 플랫폼 환경 내에서만 커스터마이징이 가능
- 특정 플랫폼의 제한으로 인해 일부 요구사항에 부합하지 않을 수 있음

**예시**

- Heroku, AWS Elastic Beanstalk, Google App Engine

---

### 4. SaaS (Software as a Service)

**정의**

- **SaaS**는 소프트웨어 애플리케이션을 인터넷을 통해 제공하는 서비스 모델로, 최종 사용자는 별도의 설치 없이 웹 브라우저 등을 통해 소프트웨어를 사용합니다. 백엔드 인프라와 애플리케이션 유지 관리는 모두 클라우드 제공업체가 담당합니다.

**특징**

- **즉시 사용 가능:** 별도의 설치 과정 없이 서비스 가입 후 바로 사용 가능
- **자동 업데이트:** 소프트웨어 및 보안 업데이트가 백엔드에서 자동 적용됨
- **멀티 테넌시:** 다수의 사용자가 동일한 소프트웨어 인스턴스를 공유하는 경우가 많습니다.

**장점**

- 낮은 초기 투자 비용 및 유지보수 부담
- 접근성과 사용 편의성이 높음
- 다양한 기기에서 동일한 환경 제공

**단점**

- 맞춤형 기능 구현의 한계
- 데이터 및 보안 문제에 대한 우려
- 벤더 종속성 문제

**예시**

- Google Workspace, Salesforce, Microsoft Office 365

---

### 서비스 형태별 카프카 운영 방법

| 서비스 종류 | 카프카 운영 방법 |
| --- | --- |
| 온프레미스 | - 물리장비(서버) 구매, 네트워크 설치 구성
- 물리잘비 운영체제 설치 수행
- 오픈소스 카프카 설치, 운영
- 또는 기업용 카프카(컨플루언트 플랫폼등) 설치, 운영 |
  | IaaS | - AWS, GCP와 같은 클라우드 서비스를 통해 물리/상상 컴퓨팅 리소스를 발급
- 컴퓨팅 리소스에 오픈소스 카프카 설치, 운영
- 또는 기업용 카프카(컨플루언트 플랫폼등) 설치, 운영 |
  | SaaS | - 컨플루언트 클라우드 또는 AWS MSK는 대표적인 Saas
- 다양한 주변 생태계(ksqlDB, 모니터링 도구 등)를 옵션으로 제공 |

---

### 오픈 소스 카프카를 직접 설치하여 운영하는 경우

Iaas 또는 온프레미스 환경에서 카프카 클러스터를 설치하여 운영하는 것이 가장 흔한 운영 방식이다. 카프카는 전송된 데이터를 모두 파일 시스템에 저장하고 대규모 데이터 통신이 일어나기 때문에 고성능의 하드웨어를 사용해야 한다.

컨플루언트에서는 상용 환경의 카프카 클러스터 운영시 브로커의 하드웨어를 다음과 같이 설정하는 것을 추천한다.

- 메모리: 32GB 머신에 힙 메모리 6GB 설정, 나머지는 OS 페이지 캐시 영역으로 활용
- CPU: 24core 머신 사용. 만약 SSL 같은 보안 설정 사용할 경우 추가 더 높은 사용 필요
- 디스크: RAID 10으로 설정된 디스크 사용. NAS는 사용하면 안됨.
- 네트워크: 사용하는 데이터 통신량에 따라 다름
- 파일시스템: XFS 또는 ext4
- RAID 란?

  ### 1. RAID란?

    - **RAID**(Redundant Array of Independent Disks)
        - 여러 개의 물리 디스크(하드 디스크 또는 SSD)를 조합하여 **논리적으로 하나의 디스크처럼** 보이도록 구성하는 기술입니다.
        - **목표**:
            1. **성능(Performance)** 향상
            2. **신뢰성(Redundancy)** 및 **가용성(Availability)** 확보
        - 서로 다른 여러 가지 구성 방식(RAID 레벨)이 존재하며, 각 레벨마다 **데이터 분산(Striping)**, **미러링(Mirroring)**, **에러 복구(Parity)** 등에 차이가 있습니다.

    ---

  ### 2. 대표적인 RAID 레벨 간단 요약

    1. **RAID 0 (Striping)**
        - **특징**: 데이터가 여러 디스크에 **분산**되어 쓰임(Striping).
        - **장점**: 읽기/쓰기 성능 향상 (병렬 처리).
        - **단점**: 디스크 중 하나라도 망가지면 전체 데이터 유실(복구 불가).
        - **용도**: 성능이 매우 중요한 환경이지만, 장애 복구가 크게 중요하지 않은 상황.
    2. **RAID 1 (Mirroring)**
        - **특징**: 동일 데이터를 여러 디스크에 **복제**(Mirroring).
        - **장점**: 하나의 디스크가 장애가 나도 다른 디스크로 동작 가능 → **고가용성**.
        - **단점**: 디스크 용량 효율이 낮음(2개 디스크로 1개 디스크 용량만 사용).
        - **용도**: 중요 데이터 보호가 필수적인 환경.
    3. **RAID 5 (Striping with Parity)**
        - **특징**: 데이터 블록과 패리티(Parity) 정보를 분산 저장.
        - **장점**: 하나의 디스크가 망가져도 복구 가능, Disk 효율이 좋음.
        - **단점**: 쓰기 연산 시 패리티 계산 부담, 두 개 이상 디스크 장애 발생 시 위험.
        - **용도**: 읽기/쓰기 밸런스가 필요한 서버, 파일/미디어 서버 등.
    4. **RAID 10 (RAID 1+0 / RAID 0+1)**
        - **특징**: **RAID 1**과 **RAID 0**을 **결합**한 하이브리드 방식.
            - 여러 개의 디스크를 **Mirroring(1)**으로 묶고, 이 묶음(미러 세트)들을 다시 **Striping(0)**으로 구성하여 **성능**과 **가용성**을 함께 확보.
        - **장점**: 디스크 중 일부가 망가져도(mirroring 덕분) 운영 가능하면서도(고가용성), striping 효과로 **높은 성능**을 기대할 수 있음.
        - **단점**: 디스크를 **최소 4개** 이상 필요로 하며, 디스크 용량 효율도 RAID 0 보다는 떨어짐.
        - **용도**: 데이터 무결성과 성능을 모두 중시하는 환경(예: DB 서버).
- XFS , ext4 란?

  ### ext4 파일시스템

    - **설명**
        - ext4(extended filesystem 4)는 **리눅스**에서 가장 널리 사용되는 저널링(Journaling) 파일시스템 중 하나입니다.
        - ext3의 후속 버전으로, 대규모 스토리지 및 성능 향상을 위해 개선되었습니다.
    - **주요 특징**
        1. **저널링(Journaling)**
            - 시스템 충돌이나 갑작스러운 정전이 발생했을 때 데이터 무결성을 높이기 위해 변경 사항을 로그(저널)에 기록 후 실제 데이터 영역에 반영합니다.
        2. **대용량 볼륨 및 파일 지원**
            - 최대 1EB(Exabyte)까지 파일시스템 크기를 지원하며, 단일 파일은 최대 16TB 정도까지 지원 가능(리눅스 커널 버전에 따라 다를 수 있음).
        3. **빠른 fsck(File System Check)**
            - ext4는 메타데이터 구조를 개선하여 파일시스템 검사 속도를 크게 단축했습니다.
        4. **Extent 기반 할당**
            - 작은 블록 단위가 아닌 큰 범위를 묶어(Extent) 데이터를 할당함으로써 디스크 조각화를 줄이고 성능을 높입니다.
    - **장점**
        - **안정성**과 **호환성**이 뛰어남 (오랜 기간 리눅스 기본 파일시스템으로서 사용됨)
        - 대규모 스토리지 활용 가능
        - 비교적 간편하고 관리가 쉬움
    - **단점**
        - 최신 고성능 파일시스템(XFS, Btrfs 등)에 비해 확장성이나 동적 스냅샷 기능이 부족할 수 있음

    ---

  ### XFS 파일시스템

    - **설명**
        - XFS는 **SGI(Silicon Graphics, Inc.)**에서 개발한 64비트 고성능 저널링 파일시스템입니다.
        - 대규모 스토리지와 병렬 I/O(특히 멀티 코어/CPU 환경)에서 **높은 성능**을 발휘하도록 설계되었습니다.
    - **주요 특징**
        1. **고성능, 확장성**
            - 대용량 파일(최대 8EB)과 대용량 파티션을 효율적으로 관리하며, 멀티 스레드 I/O 처리 성능이 뛰어남.
        2. **온라인 확장(Online Resize)**
            - 파일시스템을 마운트한 상태에서도 크기를 확장할 수 있어(물론 디스크 파티션 확장도 필요), 가용성과 편의성을 높임.
        3. **저널링**
            - ext4와 마찬가지로 **저널링** 방식을 사용하여 크래시 복구에 유리함.
        4. **디스크 조각화 방지**
            - 디스크 조각화를 자동으로 최소화하고, 필요 시 직접 `xfs_fsr` 등 도구로 조각화를 정리 가능.
    - **장점**
        - 대규모 스토리지 환경에서 **우수한 성능**
        - 실시간 확장(온라인 확장) 지원
        - 우수한 병렬 처리 성능
    - **단점**
        - ext4에 비해 시스템에 따라 약간의 호환성 차이가 있을 수 있음 (대부분의 최신 리눅스 배포판에서 기본 지원)
        - 파일시스템 축소(Online Shrink)는 공식적으로 지원하지 않아, 용량을 줄이는 작업은 까다로울 수 있음

---

### 오픈 소스 카프카를 직접 설치하여 운영하는 경우

| 항목 | 개발용 클러스터 | 사용 환경 카프카 클러스터 |
| --- | --- | --- |
| 브로커 개수 | 5개 | 10개 |
| 메모리 | 16GB(heap 6GB) | 32GB(heap 6GB) |
| CPU | 16core | 24core |
| 디스크 | 사용량에 따라 달라짐 | 사용량에 따라 달라짐 |


---

## SaaS형  카프카

### 컨플루언트

컨플루언트는 카프카에 대한 개념을 최초로 생각하고 아키텍처를 제안, 개발한 인물인 제이 크랩스와 그의 동료들이 설립한 회사이다. 컨플루언트는 아파치 카프카의 생태계를 가꾸고 발전시키는 데에 선구적인 역할을 하고 있다. 컨플루언트에서 오픈소스로 공개하고 관리하하고 있는 스키마 레지스트리, ksqlDB 등과 같은 소스 코드들은 카프카를 활용하는 생태계의 범위를 점차 늘려가고 있다.

---

### 컨플루언트 클라우드, 컨플루언트 플랫폼

| 컨플루언트 클라우드 | 컨플루언트 플랫폼 |
| --- | --- |
| - 클라우드 기반 카프카 클러스터
- 요구사항에 따라 자동으로 늘려주는 클러스터 리소스 제공
- GCP,AWS 등 클러스터 설치 위치(리전 단위) 지정 가능
- 120개가 넘는 커넥터, ksqlDB, 스키마 레지스트리 서비스 제공
- 99.95% SLA
- 엔터프라지 수준의 보안 수준 제공
- 데이터 적재 제한 없음 | - 온프레미스 기반 설치형 카프카 클러스터
- 서버를 내부에서 발급하여 직접 설치
- 필요에 따라 컨플루언트 팀에서 지원, 학습 제공
- 단계별 스토리지 기능(Tiered-Storage) 제공
- GUI 기반 모니터링 시스템 제 |

---

### AWS MSK

MSK(Managed Streaming For Apach Kafka)는 AWS 에서 제공하는 SaaS형 아파치 카프카 서비스이다. AWS MSK는 AWS 인프라에서 카프카 클러스터를 생성 업데이트, 삭제등 과 같은 운영 요소를 대시보드를 통해 제공한다.

또한 안전하게 접속할 수 있도록 클러스터와 연동시 TLS인증 보안을 설정할 수 있다. MSK로 클러스터를 생성하고자 하는 엔지니어는 아파치 카프카 버전을 직접 선택할 수 있다. 그렇기 때문에 기존에 카프카 클라언트를 운영하고 있는 기업은 버전 차이에 의한 서비스 연동 이슈를 발생시키지 않고 안전하게 클러스터를 사용할 수 있다.

MSK로 생성한 클러스터는 AWS에서 제공하는 인프라 영역에 구축된다. MSK는 AWS에서 운영하는 애플리케이션과 쉽게 연동할 수 있기 때문에 AWS를 이미 사용 중인 기업에서는 어렵지 않게 아키텍처에 포함 시킬 수 있다.

---

### SaaS로 카프카 클러스터를 운혈 경우 장점/단

## 장점

### 1. 운영 및 관리 부담 감소 (인프라 관리의 효율화)

- **자동 관리 및 유지보수:** 서비스 제공업체가 하드웨어와 소프트웨어 패치, 보안 업데이트, 백업, 장애 복구 등을 관리하므로, 개발팀이나 운영팀이 인프라 관리에 많은 자원을 할애할 필요가 없습니다.
- **모니터링 및 알림:** 기본적으로 제공되는 모니터링 도구와 알림 시스템을 통해 클러스터 상태를 손쉽게 파악할 수 있습니다.

### 2. 확장성과 유연성

- **자동 스케일링:** 클라우드 환경의 이점을 활용해 필요에 따라 리소스를 손쉽게 확장하거나 축소할 수 있습니다.
- **탄력적인 리소스 할당:** 사용량에 맞춘 비용 과금(Pay-as-you-go) 방식으로 경제적인 운영이 가능합니다.

### 3. 빠른 도입 및 개발 속도 향상

- **즉시 사용 가능:** 초기 인프라 구성 없이 바로 서비스를 시작할 수 있어, 개발 및 테스트 주기 단축에 기여합니다.
- **통합 관리 인터페이스:** 웹 기반 대시보드나 API를 통해 클러스터 관리를 쉽게 할 수 있어 개발자가 비즈니스 로직에 집중할 수 있습니다.

### 4. 내장된 보안 및 규정 준수

- **보안 기능 제공:** 암호화, 인증, 접근 제어 등 기본적인 보안 기능이 내장되어 있어, 별도 보안 인프라를 마련할 필요 없이 높은 수준의 보안을 확보할 수 있습니다.
- **규정 준수:** 일부 서비스는 산업별 규정 준수(예: GDPR, HIPAA 등)를 지원하여 기업의 컴플라이언스 요구사항을 충족할 수 있습니다.

---

## 단점

### 1. 벤더 종속(Vendor Lock-in)

- **이식성 이슈:** 한 서비스에 종속되면, 다른 서비스로 이전할 때 데이터 마이그레이션과 운영 체계 변경에 따른 어려움이 발생할 수 있습니다.
- **계약 조건 및 정책:** 서비스 제공업체의 정책 변경이나 가격 정책에 영향을 받을 수 있습니다.

### 2. 제한된 구성 및 제어 권한

- **커스터마이징 한계:** 자체 구축과 달리 클러스터 설정 및 내부 파라미터에 대한 접근 권한이 제한되므로, 세부 튜닝이 어려울 수 있습니다.
- **고급 기능 사용 제약:** 특정 고급 기능이나 커스터마이징 옵션이 제한될 수 있어, 특수한 요구사항을 가진 애플리케이션에는 부적합할 수 있습니다.

### 3. 비용 측면 고려사항

- **운영 비용:** 사용한 만큼 비용을 지불하는 모델은 초기 투자 비용은 줄일 수 있으나, 대규모 트래픽이나 장기 운영 시에는 자체 구축보다 비용이 높아질 가능성이 있습니다.
- **예측 어려움:** 워크로드 변동에 따른 요금 예측이 어려울 수 있으며, 리소스 사용량 증가 시 예상치 못한 비용 상승이 발생할 수 있습니다.

### 4. 데이터 주권 및 규정 이슈

- **데이터 위치 문제:** 데이터가 클라우드 제공업체의 데이터 센터에 저장되므로, 특정 규제나 정책(예: 데이터 주권 법령)에 부합해야 하는 경우 주의가 필요합니다.
- **멀티테넌시 고려:** 여러 고객이 동일한 물리적 인프라를 공유하는 경우, 성능이나 보안 측면에서 추가 검토가 필요할 수 있습니다.

---
### 그럼에도 SaaS형 카프카를 사용하는 것이 나은 경우?
카프카 클러스터에 대한 운영 노하우가 부족한 상태에서 빠르게 클러스터 인프라를 구축하고 활용할때는 SaaS형 카프카가 최고의 선택지가 될 수 있다.  
  
다만, SaaS형 카프카도 결국 카프카를 설치하여 구성하는 클러스터이므로 카프카에 대한 이해를 충분히 가진 상태에서 SaaS형 카프카를 운영한다면 더욱 효과적으로 활용할 수 있다.  
  
굳이 카프카 클러스터의 인프라를 사용하면서 얻는 이점도 있기 때문이다. 그러므로 SaaS형 카프카를 도입할 때는 현재 인력의 카프카 클러스터 운영에 대한 이해의 깊이, 클러스터 구축 비용, 추후 운영상 이슈 등을 다각도로 검토하는 것이 이후 안정적인 서비스를 운하는데 밑 바탕이 될 수 있다.
  
  

---
  
### 정리
1. 컨플루언트 플랫폼은 클라우드에서 제공하는 SaaS형 카프카이다 (O/X)
    - 컨플루언트 플랫폼은 온프로미스로 설치해서 사용한다.(컴플루언트 클라우드가 SaaS)
2. SaaS를 사용하면 비용이 반드시 절감된다 (O/X)
    - 일반적인 경우에는 절감되지 않는다.
3. SaaS형 카프카를 사용하더라도 주키퍼는 사용자가 운영해야 한다 (O/X)
    - 기본적으로 SaaS형 카프카는 위임해서 사용한다.
4. AWS MSK는 컨플루언트의 대표적인 클라우드 서비스이다 (O/X)
    - AWS 에세 제공하는 서비스 이다.(오픈소스 아파치 카프카를 설치해서 제공)
5. SaaS형 카프카를 사용하면 카프카에 대한 깊은 지식이 없어도 무관하다 (O/X)
    - SaaS형 카프카를 사용하더라도 카프카를 사용하고 운영하는 것은 크게 다르지 않다.