
## 카프카 Shell Script
  
### kafka-topics.sh
카프카 클러스터 정보와 토픽 이름만으로 토픽을 생성할 수 있다. 클러스터 정보와 토픽 이름은 토픽을 만들기위 한 필수 값이다.  
  
이렇게 만들어진 토픽은 파티션 개수, 복제 개수등과 같이 다양한 옵션이 포함되어 있고 특별한 설정이 없으면 브로커에 설정된 기본값으로 생성된다.
### 기본 토픽 생성


```bash


# 기본 토픽 생성 문법
bin/kafka-topics.sh --create --topic [토픽명] --bootstrap-server [브로커주소:포트]

```

```bash


bin/kafka-topics.sh --create --topic my-first-topic --bootstrap-server localhost:9092

```
  ![img_8.png](img/img_8.png)

### 토픽 목록 조회

```bash


bin/kafka-topics.sh --list --bootstrap-server localhost:9092

```

### 특정 토픽 상세 정보 확인

```bash

bin/kafka-topics.sh --describe --topic my-topic --bootstrap-server localhost:9092

```
  ![img_9.png](img/img_9.png)  
  
### 토픽 구성옵션
만약 파티션 개수, 복제 개수, 토픽 데이터 유지 기간 옵션들을 지정하여 토픽을 생성하고 싶다면 다음고 같이 명령어를 실행 하면된다.  
```bash 
bin/kafka-topics.sh --create --topic my-topic2 \
  --bootstrap-server localhost:9092 \
  --partitions 10 \
  --replication-factor 1 \
  --config retention.ms=172800000

```
![img_10.png](img/img_10.png)  

![img_11.png](img/img_11.png)

### 토픽 파티션 수 변경 (증가만 가능) --alter 옵션

```bash

bin/kafka-topics.sh --alter --topic my-topic --partitions 6 --bootstrap-server localhost:9092

```
![img_12.png](img/img_12.png)

파티션 개수를 늘릴 수 있지만 줄일 수는 없다. 다시 줄이는 명령어를 호출하면 `InvalidPartitionsException`이 발생한다. 분산 시스템에서 이미 분산된 데이터를 줄이는 방법은 매우 복잡하다.  
  
삭제 대상 파티션을 지정해야할 뿐만 아니라 기존에 저장되어 있던 레코드를 분산하여 저장하는 로직이 필요하기 때문이다. 이 때문에 카프카에서는 파티션을 줄이는 로직은 제공하지 않는다.  
  
만약 파티션의 개수를 줄여야 할 때는 토픽을 새로 만드는 편이 좋다.
![img_13.png](img/img_13.png)