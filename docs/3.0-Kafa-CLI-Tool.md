## 카프카 커맨드라인

카프카에서 제공하는 카프카 커맨드 라인 툴(command-line-tool)들은 카프카를 운영할 때 가장 많이 접하는 도구다. 커맨드 라인 툴을 통해 카프카 브로커 운영에 필요한 다양한 명령을 내릴 수 있다. 카프카 클라이언트 애플리케이션을 운영할 때는 카프카 클러스터와 연동하여 데이터를 주고받는 것도 중요하지만 토픽이나 파티션 개수 변경과 같은 명령을 실행해야 하는 경우도 발생한다. 떄문에 커맨드 라인툴과 각 툴별 옵션에 대해 알고 있어야 한다.

커맨드 라인 툴을 통해 토픽 관련 명령을 실행항 때 필수 옵션과 선택 옵션이 있다. 선택 옵션은 지정하지 않을시 브로커에 설정된 기본 설정값 또는 커맨드 라인 툴의 기본값으로 대체되어 설정된다. 따라서 설정된 기본 옵션이 어떻게 설정되어 있는지 확인하고 사용하면 실수할 확률이 줄어든다.

Apache Kafka CLI는 Kafka의 브로커, 토픽, 파티션 등 모든 요소를 관리하고 모니터링하기 위해 제공되는 명령줄 도구입니다. CLI 명령어는 주로 **Kafka 설치 디렉토리의 `/bin` 폴더**에서 실행됩니다.

> 기본 경로 예시
>
>
> `/kafka/bin`
>

## CLI 기본 사용법

CLI 명령은 스크립트로 제공되며 크게 다음과 같이 구성됩니다.

```bash

kafka-<기능명>-sh [옵션] [파라미터]

```

예시:

```bash

kafka-topics.sh --create --topic test-topic --bootstrap-server localhost:9092

```

## 주요 CLI 명령어 설명

###  `kafka-topics.sh` (토픽 관리)

토픽의 생성, 조회, 수정, 삭제 등의 작업 수행

**자주 사용하는 옵션:**

- `-create`: 새 토픽 생성
- `-list`: 토픽 목록 조회
- `-describe`: 특정 토픽의 상세 정보
- `-delete`: 토픽 삭제
- `-alter`: 기존 토픽 설정 변경

**토픽 생성 예시:**

```bash

kafka-topics.sh --create \
  --bootstrap-server localhost:9092 \
  --topic my-topic \
  --partitions 3 \
  --replication-factor 1

```

---

### `kafka-console-producer.sh` (메시지 생산)

토픽에 메시지를 전송하는 프로듀서 역할

기본 사용법:

```bash

kafka-console-producer.sh --topic my-topic --bootstrap-server localhost:9092

```

입력 후 엔터(Enter) 키를 누르면 메시지가 발송됩니다.

특정 파일의 내용을 Kafka에 전송할 때:

```bash

kafka-console-producer.sh --topic my-topic --bootstrap-server localhost:9092 < input.txt

```

---

### `kafka-console-consumer.sh` (메시지 소비)

토픽의 메시지를 실시간으로 소비하는 컨슈머 역할

**기본 사용법:**

```bash

kafka-console-consumer.sh --topic my-topic --bootstrap-server localhost:9092

```

옵션 설명:

- `-from-beginning`: 처음부터 메시지 소비
- `-group`: 컨슈머 그룹 지정

예시:

```bash

kafka-console-consumer.sh --topic my-topic \
  --bootstrap-server localhost:9092 \
  --from-beginning \
  --group my-group

```

---

### `kafka-consumer-groups.sh` (컨슈머 그룹 관리)

컨슈머 그룹의 상태 조회, offset 관리

주요 옵션:

- `-list`: 등록된 컨슈머 그룹 목록 조회
- `-describe`: 특정 컨슈머 그룹 상태 확인
- `-reset-offsets`: 컨슈머 그룹 offset 초기화 또는 변경

컨슈머 그룹 조회 예시:

```bash

kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list

```

컨슈머 그룹 상태 상세조회:

```bash

kafka-consumer-groups.sh --bootstrap-server localhost:9092 \
  --describe --group my-group

```

컨슈머 offset 초기화 예시:

```bash

kafka-consumer-groups.sh --bootstrap-server localhost:9092 \
  --group my-group \
  --reset-offsets \
  --to-earliest \
  --topic my-topic \
  --execute

```

---

###  `kafka-configs.sh` (브로커/토픽 설정 관리)

동적으로 브로커 또는 토픽 설정을 변경하는 명령

예시 - 토픽 설정 변경(예: retention 기간 변경):

```bash

kafka-configs.sh --bootstrap-server localhost:9092 \
  --entity-type topics \
  --entity-name my-topic \
  --alter \
  --add-config retention.ms=3600000

```

---

###  `kafka-acls.sh` (권한 관리)

Kafka ACL(Access Control List) 권한 설정 및 관리 명령

사용자 권한 부여 예시:

```bash

kafka-acls.sh --bootstrap-server localhost:9092 \
  --add \
  --allow-principal User:Alice \
  --operation Read \
  --topic my-topic

```

---

###  `kafka-reassign-partitions.sh` (파티션 재배치)

파티션을 다른 브로커로 이동시키거나 재분배하는 명령

예시:

```bash

kafka-reassign-partitions.sh \
  --bootstrap-server localhost:9092 \
  --execute \
  --reassignment-json-file reassignment.json

```

(`reassignment.json` 파일 예시)

```json

{
  "version": 1,
  "partitions": [
    {"topic": "my-topic", "partition": 0, "replicas": [2,3]},
    {"topic": "my-topic", "partition": 1, "replicas": [3,1]}
  ]
}

```

---

###  `kafka-run-class.sh` (유틸리티 클래스 실행)

Kafka에 포함된 다양한 유틸 클래스 실행 가능

사용 예시 - 브로커 상태 확인:

```bash

kafka-run-class.sh kafka.admin.BrokerApiVersionsCommand --bootstrap-server localhost:9092

```

---

## 🔹 3. 자주 쓰는 Kafka CLI 사용 예시 모음 (실습용)

**토픽 조회:**

```bash

kafka-topics.sh --list --bootstrap-server localhost:9092

```

**메시지 전송 및 수신 (빠른 테스트):**

```bash

# Producer
kafka-console-producer.sh --topic quick-test --bootstrap-server localhost:9092

# Consumer (처음부터 수신)
kafka-console-consumer.sh --topic quick-test --from-beginning --bootstrap-server localhost:9092

```

**컨슈머 그룹 상태 확인:**

```bash

kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group my-group

```

---

## 🔹 4. Kafka CLI를 위한 환경 설정 (팁)

- CLI 명령을 사용하기 쉽게 `PATH` 환경변수에 추가:

```bash

export PATH=$PATH:/kafka/bin

```

- 각 CLI의 옵션 확인은 `-help` 추가:

```bash

kafka-topics.sh --help

```